# ============================================================================
# MEDIUM ROBUST CONFIGURATION (MOLECULES)
# ============================================================================
# Purpose: Validate medium capacity as a robust default across all tasks
#
# Medium Configuration (Robust Default):
#   - Model: 64 hidden dimensions, 3 layers MLP (MEDIUM capacity)
#   - Sampling: Temperature = 1.0 (low exploration)
#   - Loss: Trajectory Balance (TB) with 0.01 regularization
#   - Policy: 10% off-policy ratio
#   - Conditioning: FiLM mechanism
#
# Rationale: Medium capacity provides robust performance across all tasks
#            without task-specific tuning. Serves as practical default
#            recommendation for practitioners.
#
# Performance from Factorial Analysis (medium_low condition):
#   - QDS: 0.6336 (rank 3/28 - excellent)
#   - MCE: 0.1967 (moderate - molecules have focused diversity)
#   - Hypervolume: 0.0290 (good for challenging molecular space)
#   - TDS: 0.8751 (very high trajectory diversity)
#
# Comparison to Task-Specific Best (Small: 32×2):
#   - QDS: 0.6563 (best) vs 0.6336 (medium) = -3.5% difference
#   - Medium achieves 96.5% of task-specific optimal performance
#   - Advantage: Works well across all tasks without task-specific tuning
#
# Experimental Design: 1 condition × 5 seeds = 5 runs
# ============================================================================

experiment_name: "molecules_medium_robust"
study_type: "validation"

# ============================================================================
# FIXED PARAMETERS (Medium robust configuration)
# ============================================================================

fixed:
  # Task: Molecule generation
  environment: 'molecules'
  max_atoms: 38
  num_objectives: 2
  objectives:
    - "qed"  # Drug-likeness
    - "sa_score"  # Synthetic accessibility

  # Model architecture (MEDIUM capacity - robust default)
  hidden_dim: 64
  num_layers: 3
  conditioning: "film"  # FiLM conditioning mechanism
  activation: "relu"

  # Sampling strategy (low temperature for chemical validity)
  temperature_sampling: 1.0  # Low exploration for chemical validity
  sampling_strategy: "categorical"

  # Loss function (Trajectory Balance)
  loss_function: "trajectory_balance"  # TB loss
  loss_params:
    log_reward_clip: 10.0
  regularization: "entropy"
  regularization_params:
    beta: 0.01  # 0.01 regularization
  modifications: "none"
  modifications_params: {}

  # Preference sampling
  preference_distribution: "dirichlet"
  dirichlet_alpha: 1.5
  num_preferences_per_batch: 16

  # Training parameters
  max_iterations: 12000
  batch_size: 128
  optimizer: "adam"
  learning_rate: 0.001
  gradient_clip: 10.0
  off_policy_ratio: 0.1  # 10% off-policy

  # Evaluation
  eval_every: 500
  eval_samples: 1000
  final_eval_samples: 10000

  # Seeds (same as factorial study)
  num_seeds: 5
  base_seed: 42

# ============================================================================
# SINGLE CONDITION: Medium Robust Configuration
# ============================================================================

factors:
  # Single factor with one level (medium robust config)
  config:
    description: "Medium capacity robust default configuration"
    levels:
      medium_robust:
        label: "Medium (64×3, τ=1.0, TB, FiLM)"
        # All parameters are in fixed section
        description: "Robust default: medium_low"

# ============================================================================
# EXPERIMENTAL CONDITIONS (Single condition)
# ============================================================================

conditions:
  - name: "medium_robust"
    config: "medium_robust"

# ============================================================================
# METRICS TO EVALUATE
# ============================================================================

metrics:
  primary:
    - quality_diversity_score  # QDS: PRIMARY selection criterion
    - trajectory_diversity_score  # TDS: Path diversity (very important for molecules)
    - mode_coverage_entropy  # MCE: Spatial diversity
    - hypervolume  # Quality: Pareto front coverage

  secondary:
    - preference_aligned_spread  # PAS: Diversity aligned with preferences
    - pareto_front_smoothness  # PFS: Preference alignment
    - flow_concentration_index  # FCI: Flow concentration
    - diversity_efficiency_ratio  # DER: Diversity per computation
    - pairwise_minimum_distance  # PMD: Objective space spread
    - replay_buffer_diversity  # RBD: Training sample diversity

# ============================================================================
# VALIDATION OBJECTIVES
# ============================================================================

validation:
  purpose: "Validate medium capacity as robust default for Molecules"

  hypotheses:
    h1_qds:
      statement: "Medium config achieves near-optimal Quality-Diversity Score"
      prediction: "QDS > 0.61"
      rationale: "Medium capacity (64×3) achieves 96.5% of task-specific best"

    h2_tds:
      statement: "Medium config achieves very high Trajectory Diversity Score"
      prediction: "TDS > 0.85"
      rationale: "Molecular construction paths are inherently diverse"

    h3_validity:
      statement: "Medium config generates chemically valid molecules"
      prediction: "Validity > 90%"
      rationale: "Low temperature sampling maintains chemical validity"

    h4_robustness:
      statement: "Medium config shows stable performance across seeds"
      prediction: "Coefficient of variation < 0.20"
      rationale: "Medium capacity balances expressiveness and generalization"

  expected_performance:
    qds_mean: ">0.61"
    qds_std: "<0.05"
    tds_mean: ">0.85"
    tds_std: "<0.05"
    mce_mean: ">0.18"
    mce_std: "<0.03"
    hypervolume_mean: ">0.025"
    hypervolume_std: "<0.01"

  comparison_baseline:
    description: "Compare against task-specific best (Small: 32×2, τ=1.0)"
    expectation: "Medium should achieve >95% of task-specific best QDS"

# ============================================================================
# COMPUTATIONAL RESOURCES
# ============================================================================

resources:
  total_runs: 5  # 1 condition × 5 seeds
  estimated_time_per_run: "48 minutes"  # 20000 iterations on molecules (slower)
  total_time_sequential: "4 hours"
  total_time_parallel: "48 minutes"  # With 5 parallel jobs

  storage_per_run: "~42 MB"
  total_storage: "~210 MB"

# ============================================================================
# SUCCESS CRITERIA
# ============================================================================

success_criteria:

  minimum_performance:
    qds: 0.61  # Must exceed 0.61 (95% of task-specific best)
    tds: 0.80  # Must exceed 0.80 for trajectory diversity
    mce: 0.15  # Must exceed 0.15 for mode coverage
    validity: 0.85  # Must exceed 85% valid molecules

  robustness:
    description: "Medium as robust default across tasks"
    max_coefficient_of_variation: 0.20  # CV = std/mean < 0.20

  comparison_to_best:
    description: "Performance relative to task-specific best"
    min_qds_ratio: 0.95  # Must achieve >95% of task-specific best QDS
